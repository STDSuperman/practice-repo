
[![Module Federation.jpg](https://s3.ax1x.com/2021/03/07/6KH4Qe.jpg)](https://imgtu.com/i/6KH4Qe)

## Module Federationä»‹ç»
`Module Federation`ä½¿ `JavaScript` åº”ç”¨å¯ä»¥åŠ¨æ€è¿è¡Œå¦ä¸€ä¸ª `JavaScript` åº”ç”¨ä¸­çš„ä»£ç ï¼ŒåŒæ—¶å¯ä»¥å…±äº«ä¾èµ–ã€‚

å¦‚ä½•ç†è§£ä¸Šé¢è¿™å¥è¯å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»å®é™…åœºæ™¯å‡ºå‘æ¥çœ‹å¾…è¿™é¡¹æŠ€æœ¯ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸èƒ½é‡åˆ°éœ€è¦å¤ç”¨ä¸€æ®µä»£ç é€»è¾‘çš„åœºæ™¯ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ç§æ–¹å¼å»å®ç°è¯‰æ±‚ã€‚

### æ–‡ä»¶æŠ½ç¦»æ–¹å¼

å¦‚æœè¯´åªéœ€è¦åœ¨å½“å‰é¡¹ç›®ä¸‹è¿›è¡Œå¤ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯ååˆ†ç®€å•è€Œå¿«é€Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ª`js`æ–‡ä»¶ï¼Œå°†è¿™æ®µä»£ç æ”¾è¿›å»ï¼Œå¹¶æš´éœ²å‡ºæ¥å³å¯å®ç°éœ€æ±‚ã€‚

è™½è¯´è¿™ç§æ–¹å¼å¾ˆç®€æ´å¹¶ä¸”é«˜æ•ˆï¼Œä½†å®ƒçš„å±€é™æ€§ä¹Ÿæ˜¯ååˆ†æ˜æ˜¾ï¼Œå®ƒä»…æ”¯æŒå½“å‰é¡¹ç›®ä¸‹è¿›è¡Œä½¿ç”¨ï¼Œå¦‚æœè¯´æˆ‘ä»¬æƒ³è¦å¤šä¸ªé¡¹ç›®è¿›è¡Œå¤ç”¨ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠç›¸å…³ä»£ç è¿›è¡Œå¤åˆ¶ç²˜è´´ï¼Œä¹Ÿå°±æ˜¯ååˆ†ç®€å•è€Œåˆå®ç”¨çš„`CV`å¤§æ³•ï¼Œè¿™ç§æ–¹å¼æ— ç–‘æ˜¯æœ€ç²—æš´çš„ï¼Œå®ƒå¾ˆå¯èƒ½åœ¨æˆ‘ä»¬é¡¹ç›®è¶Šæ¥è¶Šå¤§ä¹‹åï¼Œè®©ä½ åœ¨åç»­çš„ç»´æŠ¤è¿‡ç¨‹ä¸­ç—›å“­æµæ¶•ã€‚

### npmåŒ…æ–¹å¼
å¯¹äºå¤šé¡¹ç›®è¿›è¡Œå…±åŒä¾èµ–çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªå…¬å…±`npm`åŒ…çš„æ–¹å¼ï¼Œåœ¨éœ€è¦ä½¿ç”¨çš„é¡¹ç›®ä¸­è¿›è¡Œå®‰è£…å¹¶è¿›è¡Œå¯¼å…¥ã€‚è¿™ç§æ¨¡å¼å¯ä»¥å¼¥è¡¥æˆ‘ä»¬ä¸Šè¿°æ–¹å¼çš„ä¸è¶³ï¼Œå®ç°å¤šé¡¹ç›®å…±ç”¨çš„èƒ½åŠ›ï¼Œè¿™æ˜¯å®ƒçš„ä¼˜åŠ¿ï¼Œé¿å…å†—ä½™ä»£ç ã€‚

ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ€æ˜¾è‘—çš„ç¼ºé™·åœ¨äºï¼Œæˆ‘ä»¬æ¯æ¬¡å¯¹è¿™ä¸ªå…¬å…±åº“è¿›è¡Œä¿®æ”¹çš„åŒæ—¶ï¼Œå¦‚æœæƒ³è®©å…¶ä»–ä¾èµ–çš„é¡¹ç›®èƒ½å³æ—¶äº«ç”¨æ–°ç‰¹æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¯¹è¿™äº›é¡¹ç›®è¿›è¡Œæ›´æ–°ç‰ˆæœ¬å¹¶é‡æ–°è£…åŒ…ï¼Œç„¶åå®æ–½æ‰“åŒ…ä¸Šçº¿çš„æµç¨‹ï¼Œå¯¹äºå¤§å‹é¡¹ç›®å¹¶ä¸”ç‰µæ‰¯åˆ°å¤æ‚é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªä»£ä»·æ˜¯ååˆ†æ˜‚è´µçš„ã€‚

> è¯´äº†è¿™ä¹ˆå¤šï¼Œç»ˆç©¶è¿˜æ˜¯è¦è®©ä»Šå¤©çš„ä¸»è§’å‡ºåœºäº†ã€‚
### Module Federationæ–¹å¼
é’ˆå¯¹ä¸Šé¢åœºæ™¯å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥é€ä¸€èŠèŠè¿™å“¥ä»¬çš„å®åŠ›ã€‚

è¿˜æ˜¯ä¸Šè¿°çš„å¤ç”¨é€»è¾‘çš„åœºæ™¯ï¼Œå¦‚æœæ¢æˆ`Module Federation`æ¥åšï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠéœ€è¦å¤ç”¨çš„ä»£ç æŠ½ç¦»åˆ°å•æ–‡ä»¶ä¸­ï¼ˆä¸æŠ½ä¹Ÿè¡Œï¼Œåªè¦èƒ½æš´éœ²å‡ºæ¥å°±è¡Œï¼‰ï¼Œæ¥ç€æˆ‘ä»¬é…ç½®ä¸€ä¸‹`Module Federation`çš„é…ç½®ï¼Œå°†è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯¼å‡ºï¼Œä½¿ç”¨æ–¹å°±å¯ä»¥ç›´æ¥è¿œç¨‹å¤ç”¨è¿™ä¸ªæ–‡ä»¶äº†ï¼Œå¹¶ä¸”ä¸éœ€è¦åœ¨ä¹è¿™ä¸ªå¤ç”¨æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹ï¼Œå®ƒä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬å¤„ç†å¥½ã€‚

åŒæ—¶å¦‚æœå¤šä¸ªé¡¹ç›®ä½¿ç”¨äº†è¿™ä¸ªå¤ç”¨æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å¯¹å®ƒè¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œåªéœ€è¦å¯¹è¿™ä¸ªæä¾›æœåŠ¡çš„é¡¹ç›®è¿›è¡Œå‘ç‰ˆå³å¯ï¼Œä½¿ç”¨æ–¹å¯ä»¥å®æ—¶è·å–åˆ°æ–°ä»£ç ã€‚

> è¯´çš„ç›´ç™½ç‚¹å°±æ˜¯ï¼Œä¸€ä¸ªå·²ç»ä¸Šçº¿çš„é¡¹ç›®ï¼Œå…¶ä»–é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé¡¹ç›®ä¸­çš„æŒ‡å®š`js`æ–‡ä»¶ï¼Œå¹¶ä¸”æ— éœ€å…³å¿ƒå…¶ä¾èµ–ã€‚

æˆ‘ä»¬è¿™é‡Œé’ˆå¯¹ä»¥ä¸Šåœºæ™¯ä¸åŒæ–¹æ¡ˆåšä¸ªç®€å•å¯¹æ¯”ï¼š

|            | jsæ–‡ä»¶ | npmåŒ… | Module Federation |
| ---------- | ------ | ----- | ----------------- |
| æ“ä½œå¤æ‚åº¦ | ç®€å•   | ä¸­ç­‰  | ä¸­ç­‰              |
| å‘ç‰ˆå¤æ‚åº¦ | å¤æ‚   | ä¸­ç­‰  | ç®€å•              |
| å¯ç»´æŠ¤æ€§   | ä½     | é«˜    | é«˜                |

## æ·±å…¥Module Federation

é€šè¿‡ä¸Šé¢åœºæ™¯ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹`Module Federation`å·²ç»æœ‰äº†ä¸€ä¸ªå¤§æ¦‚çš„å°è±¡â€”â€”è¿™å“¥ä»¬èƒ½ç›´æ¥ä½¿ç”¨è¿œç«¯é¡¹ç›®çš„æŒ‡å®š`js`æ–‡ä»¶ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç»§ç»­æ¢ç©¶è¿™é¡¹æŠ€æœ¯å¯¹æˆ‘ä»¬æ—¥å¸¸ä¸šåŠ¡å¸¦æ¥çš„ç¦éŸ³ã€‚

[![æ¶æ„æ¦‚è§ˆ.png](https://s3.ax1x.com/2021/03/07/6M2UED.png)](https://imgtu.com/i/6M2UED)

> è¿™é‡Œå€Ÿç”¨[ä¸çŸ¥åå¤§ä½¬](https://ichi.pro/ru/arhitektura-micro-fe-webpack-5-ob-edinenie-modulej-i-nastraivaemyj-kod-zapuska-10768553412204)çš„ä¸€å¼ å›¾

### èƒŒæ™¯

ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å½“å‰`Vue`ã€`React`æ¡†æ¶æ¨ªè¡Œçš„æ—¶ä»£ä¸‹ï¼Œæˆ‘ä»¬å†™çš„æœ€å¤šçš„è«è¿‡äºå„å¼å„æ ·çš„ç»„ä»¶ï¼Œä¸ä»…å¦‚æ­¤ï¼Œä¸ºäº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæŠ½ç¦»å‡ºè®¸è®¸å¤šå¤šçš„å…¬å…±ç»„ä»¶æˆ–æ–¹æ³•ï¼Œä¹Ÿæ­£æ˜¯åœ¨è¿™ä¸ªéœ€æ±‚ä¸‹ï¼Œå‚¬ç”Ÿäº†ä¸€æ‰¹æ‰¹ä¼˜è´¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶åº“æˆ–è€…`utils`åº“ã€‚

åŒæ ·çš„ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹åº“ä¹Ÿé¢ä¸´ç€æˆ‘ä»¬å¼€ç¯‡èŠåˆ°çš„é—®é¢˜ï¼Œå¦‚ä½•å¿«é€Ÿè€Œæ–¹ä¾¿çš„è¿›è¡Œå‘ç‰ˆå’Œç»´æŠ¤ã€å¦‚ä½•é™ä½ç”¨æˆ·ä½¿ç”¨è´Ÿæ‹…è¿™ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦å€¼å¾—å¤§å®¶æ€è€ƒçš„é—®é¢˜ã€‚

åœ¨ä¸€äº›å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å®‰è£…å¤§é‡çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œåœ¨`webpack`çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬è™½ç„¶èƒ½æ–¹ä¾¿çš„è¿›è¡Œé¡¹ç›®çš„å¼€å‘ï¼Œä½†ä¸å¾—ä¸æå˜´ä¸€è¯´çš„åœ°æ–¹å°±æ˜¯ï¼Œåœ¨é¡¹ç›®ä¼˜åŒ–åšçš„ä¸å¥½çš„æƒ…å†µä¸‹ï¼Œå‡ºç°ä¸€è¡Œä»£ç æ”¹åŠ¨ç­‰å‡ åˆ†é’Ÿè¿˜çœŸæ˜¯æœ‰å¯èƒ½çš„äº‹ã€‚

ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™é¡¹ç¼ºé™·ï¼Œè¯¸å¦‚å°¤å¤§ç­‰å„ä¸ªå‰ç«¯å¤§ç‰›ä»¬éƒ½åœ¨æ¢ç´¢`no webpack`çš„æ–¹å¼ï¼Œæ¯”å¦‚æœ€è¿‘å¤§ç«çš„`vite 2.0`çš„è¯ç”Ÿï¼Œä¹Ÿçš„ç¡®ç»™æ·±å—`webpack`â€œæŠ˜ç£¨â€çš„è®¸å¤šå¼€å‘å¸¦æ¥äº†æ–°çš„è§£å†³æ–¹æ¡ˆã€‚åŸºäºè¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œéš¾é“`webpack`é™¤äº†ä¸æ–­çš„èµ°ä¼˜åŒ–ä¹‹è·¯æ¥é™ä½æ„å»ºæ—¶é—´ä¹‹å¤–å°±çœŸçš„æ²¡æœ‰ä»€ä¹ˆå…¶ä»–çš„å¥½çš„åŠæ³•äº†å—ï¼Ÿ

> ä»å‰æˆ–è®¸æˆ‘ä¼šå›ç­”è¯´`Yes`ï¼Œä½†ä»Šå¤©æˆ‘æƒ³è¯´ä¸€æ¬¡`NO`ï¼Œ`webpack`è¿˜èƒ½å†æŠ¢æ•‘æŠ¢æ•‘ï¼

æœ¬æ–‡å¯¹åº”å®è·µé¡¹ç›®åœ°å€ï¼š[é¡¹ç›®æºç åœ°å€](https://github.com/STDSuperman/practice-repo/tree/master/module-federation)

> å»ºè®®`clone`é¡¹ç›®è¿›è¡Œä½“éªŒã€‚

### Module Federationåº”ç”¨åœºæ™¯

#### æä¾›å…¬å…±æœåŠ¡èƒ½åŠ›

è¿™ä¸€ç‚¹ç¬”è€…ä¸»è¦æƒ³æçš„å°±æ˜¯å®ƒèƒ½æä¾›è¿œç¨‹å…¬å…±ç»„ä»¶å’Œ`js`æ¨¡å—çš„èƒ½åŠ›ã€‚

æ€ä¹ˆè¯´å‘¢ï¼Œå¦‚æœè¿ç”¨äº†è¿™é¡¹èƒ½åŠ›ï¼Œæˆ‘ä»¬å°±ä¸å†éœ€è¦ç»„ä»¶åº“`npm`åŒ…è¿™ç§ä¸œè¥¿äº†ï¼Œç›´æ¥æŠ½ä¸€ä¸ªé¡¹ç›®ç”¨æ¥æ‰¿è½½è¿™é¡¹èƒ½åŠ›ï¼Œæ‰€æœ‰çš„å…¬å…±ç»„ä»¶ç›´æ¥é€šè¿‡ä¸€ä¸ªè¿œç¨‹é“¾æ¥å°±èƒ½ç›´æ¥è·å–ï¼Œå®Œå…¨ä¸éœ€è¦å®‰è£…ï¼Œå°±å¯ç›´æ¥ä½¿ç”¨ã€‚

è¯ä¸å¤šè¯´ï¼Œä¸Šç ï¼š

```html
<template>
  <div id="app">
    <h1>Hello Other Vue2</h1>
    <HelloWorld msg="æˆ‘æ˜¯æœ¬åœ°Vueç»„ä»¶"></HelloWorld>
    <HelloWorld2 msg="æˆ‘æ˜¯è¿œç¨‹Vueç»„ä»¶"></HelloWorld2>
  </div>
</template>

<script>
import HelloWorld2 from '@v2hw/HelloWorld'
import HelloWorld from './components/HelloWorld'
export default {
  name: 'App',
  components: {
    HelloWorld2,
    HelloWorld
  }
}
</script>
```

æˆ‘ä»¬å…ˆä¸ç”¨ç®¡å…·ä½“æ€ä¹ˆé…ç½®çš„ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ª`import HelloWorld2 from '@v2hw/HelloWorld'`æ˜¯ä¸€ä¸ªç”¨æ¥å¯¼å…¥ä¸€ä¸ªè¿œç¨‹çš„ç»„ä»¶çš„ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½ç›´æ¥è¿›è¡Œæ³¨å†Œä½¿ç”¨äº†ã€‚

çœ‹çœ‹æ•ˆæœï¼š

[![preview.png](https://s3.ax1x.com/2021/03/07/6KvJ6f.png)](https://imgtu.com/i/6KvJ6f)

å·¦è¾¹æ¸²æŸ“çš„æ˜¯å½“å‰é¡¹ç›®ä¸‹çš„ç»„ä»¶ï¼Œå³è¾¹åˆ™è¡¨ç¤ºçš„æ˜¯ä»è¿œç«¯è·å–å¹¶æ¸²æŸ“çš„ç»„ä»¶ï¼Œæ˜¯ä¸æ˜¯ååˆ†åˆºæ¿€ã€‚

> æœ‰äº†è¿™é¡¹èƒ½åŠ›ï¼Œè¿˜è¦ç»´æŠ¤ä¸ªğŸ”¨ç»„ä»¶åº“ã€‚

åŒç†ï¼Œè¿™ç§è¿œç¨‹å¼•å…¥çš„èƒ½åŠ›ä¸€æ ·é€‚ç”¨`js`æ¨¡å—ã€‚

#### è®©é‡å¤æ„å»ºä»€ä¹ˆçš„éƒ½è§ğŸ‘»å»å§

å‘æ•£æ€è·¯ï¼Œé™¤äº†èƒ½è¿›è¡Œç»„ä»¶å¤ç”¨ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨å®ƒåšä»€ä¹ˆï¼Ÿ

>  ä¸Šé¢ç¬”è€…ç‹ ç‹ è¸©äº†`webpack`çš„æ„å»ºé€Ÿåº¦ä¸€è„šï¼Œè¿™å›ä¹Ÿè¯¥ç»™ä¸ªç”œæ£å®‰æ…°ä¸€ä¸‹è¿™å“¥ä»¬äº†ã€‚

è®©æˆ‘ä»¬ç»†ç»†å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ—¥å¸¸ä¸šåŠ¡ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¼€å‘çš„é¡¹ç›®ä½“ç§¯ä¸­ï¼Œå æ¯”æœ€å¤§çš„åº”è¯¥å½“å±æˆ‘ä»¬é‚£è®©äººåˆçˆ±åˆæ¨çš„ç¬¬ä¸‰æ–¹åŒ…äº†å§ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹åŒ…ä¸€èˆ¬æ˜¯ä¸ä¼šè¿›è¡Œä¿®æ”¹çš„ï¼Œæ‰€ä»¥æ¯æ¬¡æ„å»ºï¼ˆå…ˆä¸ç®¡ç¼“å­˜ï¼‰ï¼Œæˆ‘ä»¬ä¼¼ä¹éƒ½æ˜¯åœ¨åšé‡å¤åŠ³åŠ¨ï¼Œé‚£æˆ‘ä»¬èƒ½ä¸èƒ½å€ŸåŠ©`Module Federation`èƒ½åŠ›å°†è¿™äº›ç¬¬ä¸‰æ–¹åŒ…éƒ½æ”¾åœ¨è¿œç«¯è¿›è¡Œç»´æŠ¤ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨`runtime`çš„æ–¹å¼å¼•å…¥å°±å¯ä»¥äº†ã€‚

è¯´å¹²å°±å¹²ï¼Œç æ¥ï¼š

```html
<template>
	<div class="hello">
		<Card hoverable style="width: 240px">
			<img
				slot="cover"
				alt="example"
				src="https://os.alipayobjects.com/rmsportal/QBnOOoLaAfKPirc.png"
			/>
			<CardMeta title="Vue HelloWorld">
				<template slot="description">
					{{ msg }}
				</template>
			</CardMeta>
		</Card>
	</div>
</template>

<script>
import { Card } from '@v2hw/ant-design-vue'
// import { Card } from 'ant-design-vue'
export default {
	name: "HelloWorld",
	props: {
		msg: String,
	},
  components: {
    Card,
    CardMeta: Card.Meta
  }
};
</script>

```

è¿™é‡Œç¬”è€…å°†åŸå…ˆç›´æ¥ä»å½“å‰é¡¹ç›®å¯¼å…¥`ant-design-vue`æ”¹æˆä»è¿œç¨‹é¡¹ç›®ç›´æ¥è·å–çš„æ–¹å¼ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿå¸¦æ¥æ„å»ºæ€§èƒ½çš„æå‡ã€‚

å…‰ä»ä»£ç ä¸Šçœ‹æ— æ³•æ˜æ˜¾çš„çœ‹å‡ºä¸¤ç§æ–¹å¼å¸¦æ¥çš„å·®è·ï¼Œæˆ‘ä»¬é€šè¿‡ä»–ä»¬çš„è¿è¡Œç»“æœæ¥è¿›è¡Œåˆ†æï¼ˆæ³¨æ„çº¢è‰²åœˆåœˆä¸­çš„å†…å®¹å³å¯ï¼‰ï¼š

![webpack-build-time.png](https://s3.ax1x.com/2021/03/07/6MCQAS.png)](https://imgtu.com/i/6MCQAS)

æˆ‘ä»¬ä»å›¾ä¸­æ¥çœ‹ï¼Œä¸Šé¢ä¸€ä¸ªåœˆä¸­æ˜¯é‡‡ç”¨è¿œç¨‹ä¾èµ–çš„æ„å»ºæ—¶é—´ï¼Œåè€…å°±æ˜¯é‡‡ç”¨æœ¬åœ°ç¬¬ä¸‰æ–¹åŒ…æ–¹å¼çš„æ„å»ºæ—¶é—´ï¼Œä¸€ä¸ªæ˜¯`2713ms`ã€ä¸€ä¸ªæ˜¯`4695ms`ï¼Œæå‡é€Ÿåº¦ï¼š**42%**å·¦å³ï¼Œè¿™è¿˜ä»…ä»…åªæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…å°±èƒ½å¸¦æ¥å¦‚æ­¤å¤§çš„æå‡ï¼Œä¸€èˆ¬ç¨å¾®å¤§ç‚¹çš„é¡¹ç›®ç¬¬ä¸‰æ–¹åŒ…çš„æ•°é‡éƒ½æ˜¯ååˆ†åºå¤§çš„ï¼Œå¦‚æœå…¨é‡ç§»äº¤è¿œç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡ä»£ç ç¼–å†™ä»…ä»…åªéœ€è¦æ„å»ºæˆ‘ä»¬ç¼–å†™çš„ä»£ç ï¼Œè€Œæ— éœ€å…³å¿ƒç¬¬ä¸‰æ–¹åŒ…ï¼Œè¿™ç§æå‡çš„ç¡®è®©äººååˆ†æ¿€åŠ¨ã€‚

è¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šæœ‰ç¬”è€…æ¥é—®äº†ï¼Œé‚£æˆ‘ç›´æ¥å°†æ‰€æœ‰ç¬¬ä¸‰æ–¹å…¨éƒ¨ç”¨`cdn`å½¢å¼å¼•å…¥ä¸å°±å®Œäº‹äº†ï¼Œå’Œä½ è¿™ä¸ªè¾¾åˆ°çš„æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

è¯šç„¶ï¼Œè¿™ç§æ–¹å¼å’Œ`cdn`æ–¹å¼å¼•å…¥ç„¶åé…åˆ`webpack`çš„`external`æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä½†é‡‡ç”¨`webpack module federation`å¯ä»¥æŠŠè¿™ä¸ªåŒ…çš„æ§åˆ¶æƒæŒæ¡åœ¨è‡ªå·±æ‰‹é‡Œï¼Œæˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå¦‚æœå“ªå¤©è¿™ä¸ª`cdn`é“¾æ¥æŒ‚äº†ï¼Œæˆ‘ä»¬å´æ¯«ä¸çŸ¥æƒ…ï¼Œå¹¶ä¸”å¯¹äºå¾ˆå¤šæ ¹æœ¬ä¸æä¾›`cdn`æ–¹å¼çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå°±æ²¡æ³•è¾¾åˆ°ä½ æƒ³è¦çš„æ•ˆæœäº†ï¼Œè€Œè¿™ä¹Ÿä»…ä»…åªæ˜¯`webpack module federation`èƒ½åŠ›ä¸­çš„ä¸€é¡¹è€Œå·²ã€‚

### è¯¦ç»†é…ç½®æ–¹å¼

è¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ä¸ª`webpack5`è‡ªå¸¦çš„æ’ä»¶ï¼š`ModuleFederationPlugin`ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®è¿™ä¸ªæ’ä»¶æ¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ï¼Œé¦–å…ˆçœ‹çœ‹è¿™ä¸ªæ’ä»¶çš„é…ç½®é¡¹ï¼š

| å­—æ®µå   | ç±»å‹   | å«ä¹‰                                                                   |
| -------- | ------ | ---------------------------------------------------------------------- |
| name     | string | å¿…ä¼ å€¼ï¼Œå³è¾“å‡ºçš„æ¨¡å—åï¼Œè¢«è¿œç¨‹å¼•ç”¨æ—¶è·¯å¾„ä¸º`${name}/${expose}`          |
| library  | object | å£°æ˜å…¨å±€å˜é‡çš„æ–¹å¼ï¼Œnameä¸ºumdçš„name                                    |
| filename | string | æ„å»ºè¾“å‡ºçš„æ–‡ä»¶å                                                       |
| remotes  | object | è¿œç¨‹å¼•ç”¨çš„åº”ç”¨ååŠå…¶åˆ«åçš„æ˜ å°„ï¼Œä½¿ç”¨æ—¶ä»¥keyå€¼ä½œä¸ºname                  |
| exposes  | object | è¢«è¿œç¨‹å¼•ç”¨æ—¶å¯æš´éœ²çš„èµ„æºè·¯å¾„åŠå…¶åˆ«å                                   |
| shared   | object | ä¸å…¶ä»–åº”ç”¨ä¹‹é—´å¯ä»¥å…±äº«çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½¿ä½ çš„ä»£ç ä¸­ä¸ç”¨é‡å¤åŠ è½½åŒä¸€ä»½ä¾èµ– |

æœ‰äº†è¿™äº›æˆ‘ä»¬å°±èƒ½è¿›è¡Œå®æˆ˜æ¼”ä¹ äº†ï¼š

> è¿™é‡Œæ³¨æ„æä¸€ç‚¹ï¼Œåœ¨`ModuleFederationPlugin`çš„ä¸–ç•Œé‡Œï¼Œæ‰€æœ‰é¡¹ç›®æ—¢å¯ä»¥æ˜¯è¿œç¨‹ç»„ä»¶çš„æä¾›æ–¹ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹ç»„ä»¶çš„ä½¿ç”¨æ–¹ï¼Œä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œè¿™é‡Œåªæ¼”ç¤ºå•ä¸€æä¾›æ–¹å’Œä½¿ç”¨æ–¹ã€‚

#### ç»„ä»¶æä¾›æ–¹

æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¸€ä¸ªè¿œç¨‹ç»„ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é…ç½®ä¸€ä¸‹è¿™ä¸ªè¿œç¨‹ç»„ä»¶çš„æä¾›æ–¹ã€‚

> ä¸ºäº†æ–¹ä¾¿è§£è¯»ï¼Œç¬”è€…è¿™é‡Œç§»é™¤äº†å…¶ä»–ä¸å¿…è¦çš„ä»£ç ï¼Œä»…ç•™ä¸‹äº†`ModuleFederationPlugin`æ’ä»¶çš„ä½¿ç”¨ã€‚

```js

const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin')

module.exports = {
    plugins: [
        new ModuleFederationPlugin({
            name: 'vue2Project',
            filename: 'hello-world.js',
            exposes: {
                './HelloWorld': path.resolve(projectDir, './src/components/HelloWorld'),
                './ant-design-vue': path.resolve(projectDir, './src/utils/ant-design-vue')
            },
            shared: [vue,'ant-design-vue']
        })
    ]
}
```

é¦–å…ˆå®šä¹‰`name`å’Œ`filename`å±æ€§ï¼Œè¿™ä¸¤ä¸ªå¾ˆå…³é”®ï¼Œåœ¨ä½¿ç”¨è¿œç¨‹ç»„ä»¶çš„æ—¶å€™ä¼šè¢«ç”¨åˆ°ã€‚

##### exposes

æ•…åæ€æ„ï¼Œå°±æ˜¯æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨çš„æ„æ€ã€‚ç¬”è€…è¿™é‡Œæš´éœ²äº†ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªæ˜¯ä¸€ä¸ªå¸¸è§„çš„`HelloWorld.vue`ç»„ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯`ant-design-vue`ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢æ¼”ç¤ºçš„ä½¿ç”¨è¿œç¨‹ç¬¬ä¸‰æ–¹åŒ…çš„æœåŠ¡æä¾›æ–¹ï¼Œè¿™é‡Œä¸ç”¨çº ç»“è¿™ä¸ª`src/utils/ant-design-vue`é‡Œæ˜¯å•¥ï¼Œç»™ä½ å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„`js`æ–‡ä»¶ç„¶åå°†`ant-design-vue`å¯¼å…¥å¹¶æš´éœ²äº†ä¸€ä¸‹ï¼š

```js
// src/utils/ant-design-vue
export * from 'ant-design-vue';
```

è¿™é‡Œç¨å¾®è§£è¯»ä¸€ä¸‹è¿™ä¸ª`exposes`å¯¹è±¡é‡Œçš„ç”¨æ³•ï¼š

- å±æ€§åï¼šä¸€èˆ¬ä½¿ç”¨`./xxx`ï¼Œå®šä¹‰æˆ‘ä»¬æš´éœ²å‡ºè¿™ä¸ªç»„ä»¶çš„åå­—ï¼Œç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™å°±èƒ½ç›´æ¥å†™`å˜é‡å/xxx`äº†ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ¼”ç¤ºå¯¼å…¥æ–¹å¼ã€‚

  - ```js
    import { Card } from '@v2hw/ant-design-vue'
    ```

- å±æ€§å€¼ï¼šè¡¨ç¤ºè¿™ä¸ªç»„ä»¶çš„å®é™…ä½ç½®ã€‚

##### shared

è¿™ä¸ªå±æ€§ä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨è¿œç¨‹ç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªç»„ä»¶å¦‚æœä¾èµ–äº†æŸä¸ªç¬¬ä¸‰æ–¹åŒ…ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šé¦–å…ˆä»ä½¿ç”¨æ–¹çš„`shared`ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥æ‰¾åˆ°ä¹‹åï¼Œå°±ä¼šç›´æ¥ä½¿ç”¨å½“å‰é¡¹ç›®çš„ï¼Œå¦åˆ™åˆ™ä»è¯¥è¿œç¨‹ç»„ä»¶çš„æä¾›æ–¹è¿›è¡Œè·å–ã€‚

#### ç»„ä»¶ä½¿ç”¨æ–¹

å½“æˆ‘ä»¬çš„æä¾›æ–¹é¡¹ç›®å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ¨å¦ä¸€ä¸ªé¡¹ç›®ä¸­è¿›è¡Œä½¿ç”¨äº†ï¼š

##### å…¥å£æ–‡ä»¶ä¿®æ”¹

å¯¹äºä¸€èˆ¬çš„é¡¹ç›®æ¥è¯´ï¼Œæˆ‘ä»¬çš„å…¥å£æ–‡ä»¶éƒ½æ˜¯`src`ç›®å½•ä¸‹`index.js`æˆ–`main.js`å…¶ä»–çš„ä¹ŸåŒç†ï¼ŒåŒæ—¶è¿™ä¸ªå…¥å£æ–‡ä»¶ä¸­åšäº†å¯¹ç›¸å…³æ¡†æ¶æˆ–åº“çš„ä¸€ä¸ªåˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ª`Vue`é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼š

```js
import Vue from 'vue'
import App from './App.vue'

Vue.config.productionTip = false

new Vue({
  render: h => h(App),
}).$mount('#app')

```

è¿™é‡Œæ˜¯ä¸€ä¸ªæœ€åŸºç¡€ç‰ˆçš„å®ä¾‹åŒ–`Vue`çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨`module federation`ä¸­éœ€è¦æ€ä¹ˆä¿®æ”¹å‘¢ï¼Ÿ

å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨åŒçº§ç›®å½•ä¸‹ï¼ˆä¸åŒçº§ä¹Ÿè¡Œï¼Œçœ‹ä½ å–œå¥½ï¼‰ï¼Œæ–°å»ºä¸€ä¸ª`bootstrap.js`ï¼Œç„¶åæŠŠåŸæ¥å…¥å£æ–‡ä»¶ä¸­çš„å†…å®¹å…¨éƒ¨è½¬ç§»åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­å»ï¼Œæ¥ç€åœ¨åŸæ¥çš„å…¥å£æ–‡ä»¶ä¸­å¯¼å…¥å¹¶æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼š

```js
// index.jsæˆ–main.js
import('./bootstrap.js')
```

è¿™æ ·å°±å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°å•¦ã€‚

> è¿™é‡Œä¸€ä¸ç•™ç¥å°±æ‰è¿›å»äº†ï¼ŒçœŸæ˜¯å·¨å‘ï¼Œå½“æ—¶ç¬”è€…å°±å› ä¸ºæ²¡åŠ¨è¿™ä¸ªå…¥å£æ–‡ä»¶ï¼ŒåŠå¤©éƒ½æ²¡å¼„å‡ºæ¥ï¼Œå®˜ç½‘è¿˜å•¥ä¹Ÿæ²¡æœ‰ğŸ˜­ã€‚

é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Œè¿™å…¶å®æ˜¯`module federation`çš„ä¸€ä¸ªä¾èµ–å‰ç½®çš„æ¦‚å¿µï¼Œå¦‚æœæ˜¯åŒæ­¥æ‰§è¡Œï¼Œé‚£ä¹ˆå°±æ— æ³•ä¿è¯åœ¨å¯åŠ¨é¡¹ç›®çš„æ—¶å€™å·²ç»å‡†å¤‡å¥½äº†ä¾èµ–æ¨¡å—ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨`import`çš„æ–¹å¼å®ç°å¼‚æ­¥ï¼Œç„¶åå†ç”±`webpack`å¸®æˆ‘ä»¬å»åˆ†æä¾èµ–ï¼Œå¹¶ç­‰å¾…å‰ç½®ä¾èµ–åŠ è½½å¥½ä¹‹åå†æ‰§è¡Œ`bootstrap`ä¸­çš„ç›¸å…³å†…å®¹å¯åŠ¨é¡¹ç›®ã€‚

> è¿™é‡Œæ‰€æŒ‡çš„å‰ç½®ä¾èµ–ï¼Œä¸»è¦æ˜¯æˆ‘ä»¬å½“å‰é¡¹ç›®é‡‡ç”¨`module federation`æ¥ä½¿ç”¨è¿œç¨‹ç»„ä»¶çš„ä¾èµ–ã€‚
###### webpacké…ç½®

```js
const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin')

module.exports = {
    plugins: [
        new ModuleFederationPlugin({
            name: 'vue2TwoProject',
            filename: 'hello-world.js',
            exposes: {
                './HelloWorld': path.resolve(projectDir, './src/components/HelloWorld')
            },
            remotes: {
                '@v2hw': 'vue2Project@http://localhost:5001/hello-world.js'
            },
            shared: {
                vue: {
                    import: "vue",
                    shareKey: "vue",
                    shareScope: "default",
                    singleton: true
                }
            }
        })
    ]
}
```

å…¶ä»–å‡ ä¸ªå±æ€§ä¹Ÿå°±ä¸å¤šæäº†ï¼Œä¸Šé¢ä¹Ÿä»‹ç»å®Œäº†ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ä¸€ä¸‹è¿™ä¸ª`remotes`ã€‚

##### remotes

ç”¨äºé…ç½®è¿œç¨‹é¡¹ç›®çš„å¼•ç”¨ï¼Œå±æ€§åè¡¨ç¤ºè¿™ä¸ªå¼•ç”¨çš„åˆ«åï¼ˆå…¨å±€å”¯ä¸€å€¼ï¼‰ï¼Œå±æ€§å€¼ç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š`{name}@{url}/{filename}`ï¼š

- nameï¼š è¿œç¨‹é¡¹ç›®çš„åå­—ï¼Œä¹Ÿå°±æ˜¯è¿œç¨‹ç»„ä»¶æä¾›æ–¹`ModuleFederationPlugin`é…ç½®ä¸­çš„`name`å­—æ®µã€‚
- urlï¼š è¿œç¨‹é¡¹ç›®çš„åœ°å€
- filenameï¼šè¿œç¨‹ç»„ä»¶æä¾›æ–¹`ModuleFederationPlugin`é…ç½®ä¸­çš„`filename`å­—æ®µã€‚

æ¥ä¸‹æ¥å°±èƒ½ç›´æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†ï¼š

```js
import { Card } from '@v2hw/ant-design-vue'
```

æ˜¯ä¸æ˜¯ä¸€ä¸‹å­æ€ç»ªå°±æ¸…æ™°äº†ï¼Œè¿™ä¸ª`@v2hw`è¿œç¨‹é¡¹ç›®æš´éœ²äº†è¿™ä¸ª`ant-design-vue`å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿™ç§æ–¹å¼è¿›è¡Œè·å–äº†ã€‚

é™¤äº†ä¸Šè¿°è¿™ç§é…ç½®æ–¹å¼ä»¥å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å€ŸåŠ©`library`é…ç½®çš„æ–¹å¼æ¥ä½¿ç”¨è¿œç¨‹ç»„ä»¶ï¼ŒåŒºåˆ«å°±æ˜¯æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥è¿œç¨‹é¡¹ç›®çš„`js`æ–‡ä»¶ï¼Œç¬”è€…è¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢è¿™ç§ç›´æ¥é…ç½®æ–¹å¼ï¼Œä¸å¤ªå–œæ¬¢å†å¤šæ­¤ä¸€ä¸¾å¼•å…¥`script`æ ‡ç­¾ï¼Œè¿™é‡Œå°±ä¸è¿›è¡Œæ¼”ç¤ºäº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»å®˜ç½‘æŸ¥æ‰¾ã€‚

> å…³äºåŠ¨æ€å¼•å…¥è¿œç¨‹ç»„ä»¶çš„æ–¹å¼è¯·å¾€åçœ‹ã€‚

## å¥‡æ·«æŠ€å·§

æ—¢ç„¶æˆ‘ä»¬çš„é¡¹ç›®å…·å¤‡äº†ä½¿ç”¨å…¶ä»–é¡¹ç›®è¿œç¨‹ç»„ä»¶çš„èƒ½åŠ›ï¼Œé‚£æ˜¯ä¸æ˜¯...ï¼ˆå˜¿å˜¿å˜¿ï¼‰å¯ä»¥å°è¯•ä¸€ä¸‹åœ¨ä¸åŒæ¡†æ¶é—´äº’ç”¨ç»„ä»¶å‘¢ï¼Ÿæ¯”å¦‚`Vue3`ä½¿ç”¨`Vue2`ç»„ä»¶ï¼Œæˆ–è€…`Vue`ä¸­ä½¿ç”¨`React`é¡¹ç›®çš„ç»„ä»¶ï¼Ÿ

> æƒ³æƒ³éƒ½åˆºæ¿€ï¼Œ`try`ä¸€ä¸‹ã€‚

### Vue3ä½¿ç”¨Vue2ç»„ä»¶

é€šè¿‡å‰é¢çš„è®²è¿°ï¼Œç›¸ä¿¡å¤§å®¶å¯¹è¿œç¨‹ç»„ä»¶çš„å¯¼å…¥åº”è¯¥ä¹Ÿæœ‰äº†ä¸€å®šçš„è®¤è¯†ï¼Œåœ¨åŒç‰ˆæœ¬çš„`Vue`é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»„ä»¶å¯¼å…¥ä¹‹åç›´æ¥è¿›è¡Œæ³¨å†Œä½¿ç”¨ï¼Œè€Œå¯¹äºä¸åŒç‰ˆæœ¬çš„`Vue`ç»„ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸ªé€‚é…å™¨çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸å…¼å®¹çš„ç»„ä»¶å˜æˆå…¼å®¹çš„ï¼Œè¿™é‡Œæ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿`Vue2`ç»„ä»¶èƒ½å¤Ÿåœ¨`Vue3`ä¸­ä½¿ç”¨ï¼š

```html
<template>
  <div id="vue2HW"></div>
  <Vue2HelloWorld></Vue2HelloWorld>
</template>

<script>
import { vue2ToVue3 } from './utils'
import HelloWorld2 from '@v2hw/HelloWorld'
console.log(HelloWorld2);

export default {
  name: 'App',
  components: {
    Vue2HelloWorld: vue2ToVue3(HelloWorld2, 'vue2HW')
  }
}
</script>
```

ä»ä»£ç ä¸­çœ‹ï¼Œä¸ä¹‹å‰`Vue2`é¡¹ç›®ä½¿ç”¨`Vue2`è¿œç¨‹ç»„ä»¶ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™é‡Œåœ¨æ³¨å†Œçš„åŒæ—¶è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ï¼Œä»è¿™ä¸ªæ–¹æ³•çš„åå­—ä¸Šæ¥çœ‹æˆ‘ä»¬èƒ½å¤§æ¦‚çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå°†`Vue2`ç»„ä»¶è½¬åŒ–ä¸º`Vue3`èƒ½è¯†åˆ«çš„ç»“æ„çš„æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å…·ä½“åšäº†å“ªäº›äº‹ã€‚

#### Vueé€‚é…å™¨

åœ¨ç ”ç©¶è¯¦ç»†ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹æˆ‘ä»¬ä¸Šè¿°å¯¼å…¥çš„ç»„ä»¶æ•°æ®ç©¶ç«Ÿé•¿æˆå•¥æ ·ï¼ˆæ³¨æ„ä¸Šé¢ä»£ç çš„`console.log`ï¼‰:

[![Vue2ç»„ä»¶.png](https://s3.ax1x.com/2021/03/07/6MYX6A.png)](https://imgtu.com/i/6MYX6A)

æ²¡é”™ï¼Œå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„`Vue2 Options`å†™æ³•çš„ç»„ä»¶ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç ”ç©¶æ€ä¹ˆè½¬æ¢ï¼š

```js
import Vue2 from './vue2';

export function vue2ToVue3(WrapperComponent, wrapperId) {
    let vm;
    return {
        mounted() {
            vm = new Vue2({
                render: createElement => {
                    return createElement(
                        WrapperComponent,
                        {
                            on: this.$attrs, // Vue3æŠŠVue2çš„`$listeners`ä¸`$attrs`åˆå¹¶åˆ°`$attrs`ä¸Šå»äº†
                            attrs: this.$attrs,
                            props: this.$props,
                            scopedSlots: this.$scopedSlots
                        }
                    )
                }
            });
            vm.$mount(`#${wrapperId}`)
        },
        props: WrapperComponent.props,
        render() {
            vm && vm.$forceUpdate();
        }
    }
}
```

æˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå¯¹äºæˆ‘ä»¬`Vue`ç»„ä»¶æ¨¡æ¿æ¥è¯´ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ª`render`å‡½æ•°æä¾›æ¸²æŸ“èƒ½åŠ›ï¼Œæ•…ï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬ä»è¿œç¨‹è·å–åˆ°çš„`Vue2`ç»„ä»¶æ•°æ®å˜æˆ`Vue3`ç»„ä»¶å…¼å®¹çš„ç»“æ„ï¼Œä¿è¯`Vue3`èƒ½å¤Ÿæ­£ç¡®çš„è§£æè¯¥ç»„ä»¶ã€‚

ä»ä»£ç ä¸­çœ‹ï¼Œæˆ‘ä»¬`return`äº†ä¸€ä¸ªåŒ…å«`mounted`ã€`props`ã€`render`ä¸‰ä¸ªå±æ€§çš„å¯¹è±¡ï¼Œç›¸ä¿¡å¤§å®¶å¯¹è¿™ä¸‰ä¸ªå±æ€§ä¹Ÿä¸å¤ªé™Œç”Ÿï¼ˆå¦‚æœæœ‰ä¸ç†Ÿæ‚‰`render`å±æ€§çš„å¯ä»¥å‚è€ƒ`Vue`å®˜ç½‘`jsx`éƒ¨åˆ†ï¼‰ï¼Œç»„ä»¶è¿›è¡Œæ¯æ¬¡æ›´æ–°å’Œæ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨`render`æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å¯¹æˆ‘ä»¬åˆ›å»ºçš„`vue2`å®ä¾‹è¿›è¡Œæ›´æ–°å³å¯ã€‚ç¬¬ä¸€æ­¥å…ˆå®šä¹‰ä¸€ä¸ª`vm`å˜é‡ï¼Œç”¨äºåç»­æ¥æ”¶å®ä¾‹åŒ–åçš„`Vue`å¯¹è±¡ï¼Œç„¶åè®©æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ª`mounted`å‡½æ•°ï¼Œæ¥ä¸‹æ¥é‡ç‚¹æ¥å…³æ³¨è¿™ä¸ªå‡½æ•°æ‰€åšçš„äº‹ã€‚

æˆ‘ä»¬è¿™é‡Œå¯¼å…¥ä¸€ä¸ªä¸€ä¸ª`Vue2`ç‰ˆæœ¬çš„åŒ…ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªåŒ…å¯¹ä¼ å…¥çš„`Vue2`ç»„ä»¶è¿›è¡Œæ¸²æŸ“ï¼ŒåŒæ ·å†…éƒ¨é‡‡ç”¨`render`å‡½æ•°çš„æ–¹å¼ï¼Œè°ƒç”¨`createElement`æ–¹æ³•æ‰§è¡Œæ¸²æŸ“ï¼Œå¹¶å¯¹éœ€è¦ä¼ å…¥è¯¥ç»„ä»¶çš„å±æ€§è¿›è¡Œä¼ é€’ï¼Œç”±äº`Vue3`å’Œ`Vue2`çš„ç‰¹æ®Šæ€§ï¼Œ`on`å±æ€§ä¼ å…¥çš„ä¹Ÿæ˜¯`Vue3`çš„`$attrs`å±æ€§ã€‚

ç„¶åæ¸²æŸ“å®Œæˆä¹‹åï¼Œå†æ‰‹åŠ¨è°ƒç”¨`$mount`è¿›è¡ŒæŒ‚è½½ï¼ŒæŒ‚è½½å¯¹è±¡ä¸ºä¼ å…¥çš„`dom`ä¸Šçš„`id`ã€‚

å°±è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„`Vue2`è½¬`Vue3`å°±å®Œæˆäº†ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿååˆ†ç®€å•å‘¢ã€‚

#### åŠ¨æ€å¼•å…¥

å‰é¢æˆ‘ä»¬åœ¨ä½¿ç”¨è¿œç¨‹ç»„ä»¶çš„æ—¶å€™é‡‡ç”¨äº†é…ç½®åŒ–çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼åœ¨æœ‰äº›éœ€è¦çµæ´»åŠ¨æ€å¼•å…¥çš„æ—¶å€™å°±æ˜¾å¾—ä¸å¤Ÿæ–¹ä¾¿äº†ï¼Œæ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸‹åŠ¨æ€ç»„ä»¶å¯¼å…¥çš„æ–¹å¼ï¼š

> æ¥ä¸‹æ¥é‡‡ç”¨`Vue3`é¡¹ç›®è¿›è¡Œæ¼”ç¤ºï¼Œä¸å¤ªäº†è§£ä¹Ÿæ²¡å•¥å…³ç³»ï¼Œä½¿ç”¨å…¶ä»–æ¡†æ¶ä¹Ÿä¸€æ ·çš„ã€‚

```html
<template>
  <div id="vue2Remote"></div>
  <dynamicHelloWorld></dynamicHelloWorld>
</template>

<script>
import { defineAsyncComponent } from 'vue'
import { vue2ToVue3, loadRemoteComponent } from './utils'

export default {
  name: 'App',
  components: {
    dynamicHelloWorld: defineAsyncComponent(async () => {
        const component = await loadRemoteComponent({
            url: 'http://localhost:5001/hello-world.js',
            scope: 'vue2Project',
            module: './HelloWorld'
        });
        return vue2ToVue3(component.default, 'vue2Remote');
    })
  }
}
</script>
```

è¿™é‡Œä½¿ç”¨äº†`Vue3`çš„`defineAsyncComponent`æ³¨å†Œå¼‚æ­¥ç»„ä»¶çš„æ–¹æ³•ï¼Œå› ä¸ºåŠ¨æ€è·å–è¿œç¨‹ç»„ä»¶ä¼šæœ‰ä¸€ä¸ªè¯·æ±‚è¿œç¨‹ç»„ä»¶çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æ˜¯å¼‚æ­¥çš„ã€‚

åŒæ—¶è¿™é‡Œæ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯è¿™ä¸ª`loadRemoteComponent`æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

- urlï¼šè¿œç¨‹é¡¹ç›®åœ°å€ã€‚
- scopeï¼šè¿œç¨‹é¡¹ç›®çš„åå­—ã€‚
- moduleï¼šè¿œç¨‹é¡¹ç›®ä¸­çš„æŒ‡å®šæ¨¡å—ã€‚

ç„¶åæˆ‘ä»¬æ¥ç ”ç©¶ä¸‹è¿™ä¸ª`loadRemoteComponent`ä¸­åˆæ˜¯æ€ä¹ˆå®ç°çš„å§ï¼š

```js
export async function loadRemoteComponent(config) {
    return loadScript(config).then(() => loadComponentByWebpack(config))
}

function loadScript(config) {
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = config.url
        script.type = 'text/javascript'
        script.async = true
        script.onload = () => {
            console.log(`Dynamic Script Loaded: ${config.url}`)
            document.head.removeChild(script);
            resolve();
        }
        script.onerror = () => {
            console.error(`Dynamic Script Error: ${config.url}`)
            document.head.removeChild(script)
            reject()
        }
        document.head.appendChild(script)
    })
}

async function loadComponentByWebpack({ scope, module }) {
    // åˆå§‹åŒ–å…±äº«ä½œç”¨åŸŸï¼Œè¿™å°†ä½¿ç”¨æ­¤æ„å»ºå’Œæ‰€æœ‰è¿œç¨‹æä¾›çš„å·²çŸ¥æ¨¡å—å¡«å……å®ƒ
    await __webpack_init_sharing__('default')
    const container = window[scope] // è·å–å®¹å™¨
    // åˆå§‹åŒ–å®¹å™¨ï¼Œå®ƒå¯ä»¥æä¾›å…±äº«æ¨¡å—
    await container.init(__webpack_share_scopes__.default);
    const factory = await window[scope].get(module);
    return factory();
}
```

æˆ‘ä»¬å…ˆè§‚å¯Ÿåˆ°è¿™ä¸ª`loadRemoteComponent`æ–¹æ³•ï¼Œå®ƒå†…éƒ¨`return`äº†è·å–åˆ°çš„è¿œç¨‹ç»„ä»¶çš„æ•°æ®ï¼Œå¾€ä¸‹çœ‹è¿™ä¸ª`loadScript`æ–¹æ³•ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ª`Promise`ï¼Œå†…éƒ¨çš„ä»£ç æˆ‘ä»¬ç¨å¾®ç„ä¸€çœ¼å°±çŸ¥é“è¿™é‡Œæ˜¯åœ¨ä½¿ç”¨`js`åŠ¨æ€åˆ›å»º`script`æ ‡ç­¾çš„æ–¹å¼æ¥åŠ è½½ä¸€ä¸ªè¿œç¨‹`js`æ–‡ä»¶ï¼Œå½“åŠ è½½å®Œæ¯•æ—¶ï¼Œå°†è¿™ä¸ªæ ‡ç­¾ä»é¡µé¢ä¸­ç§»é™¤ï¼Œç„¶åç»“æŸã€‚

å½“`js`æ–‡ä»¶åŠ è½½å®Œæ¯•ä¹‹åï¼Œé¡µé¢ä¸­å°±æ‹¿åˆ°äº†è¿œç¨‹é¡¹ç›®æš´éœ²çš„ç»„ä»¶ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±èƒ½ä½¿ç”¨` loadComponentByWebpack`æ¥åŠ è½½æŒ‡å®šçš„ç»„ä»¶äº†ï¼Œè¿™ä¸ªå‡½æ•°ä¸­ä¸»è¦å°±æ˜¯åˆå§‹åŒ–è¿œç¨‹ç»„ä»¶æ‰€éœ€çš„ç¯å¢ƒï¼Œå¹¶æ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„`module`ï¼Œä»ç›¸å…³ä½œç”¨åŸŸä¸­æŸ¥åˆ°åˆ°å¯¹åº”çš„æ¨¡å—è¿›è¡Œè¿”å›ã€‚

### Reactä¸­å¼•å…¥Vue2ç»„ä»¶

åŒç†ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿéœ€è¦ä¸€ä¸ª`Adapter`ï¼Œè¿™é‡Œç¬”è€…å°±æ²¡æœ‰è‡ªå·±å†™ä¸€ä¸ªäº†ï¼Œç›´æ¥é‡‡ç”¨ç¬¬ä¸‰æ–¹åŒ…`vuera`æ¥å®ç°è¿™ä¸ªæ•ˆæœäº†ã€‚

> å®‰åˆ©å®‰åˆ©ï¼Œè¿™ä¸ªåŒ…æ”¯æŒåœ¨`Vue`ä¸­ä½¿ç”¨`React`ï¼Œä¹Ÿæ”¯æŒåœ¨`React`ä¸­ä½¿ç”¨`Vue`ã€‚

```js
import React, { useState } from "react";
import { VueWrapper } from "vuera";
import VueHelloWorld from "@v2hw/HelloWorld";
import styled from 'styled-components'
import { Card } from "antd";
const { Meta } = Card;

const AppDiv = styled.div`
  display: flex;
  justify-content: space-around;
`

const ReactContainer = styled.div`
  margin: 10px;
  display: inline-block;
  width: 240px;
  height: 400px;
`

function App() {
	return (
		<AppDiv>
			<ReactContainer>
				<Card
					hoverable
					style={{ width: 240 }}
					cover={
						<img
							alt="example"
							src="https://os.alipayobjects.com/rmsportal/QBnOOoLaAfKPirc.png"
						/>
					}
				>
					<Meta
						title="Hello World!"
						description="æˆ‘æ˜¯Reactç»„ä»¶"
					/>
				</Card>
			</ReactContainer>
			<VueWrapper component={VueHelloWorld}></VueWrapper>
		</AppDiv>
	);
}

export default App;

```

çœ‹çœ‹æ•ˆæœ

[![VueInReact.png](https://s3.ax1x.com/2021/03/07/6MR1Ig.png)](https://imgtu.com/i/6MR1Ig)

## åŸç†å‰–æ

[é¡¹ç›®æºç åœ°å€](https://github.com/STDSuperman/practice-repo/tree/master/module-federation)

é¦–å…ˆå…‹éš†é¡¹ç›®åˆ°æœ¬åœ°ï¼Œè¿›å…¥`module-federation`ç›®å½•ä¸‹ï¼ˆè¿™é‡Œå°†ä»¥æ­¤ç›®å½•ä¸­`vue2`ä¸`vue2-two`ä¸¤ä¸ªå­é¡¹ç›®è¿›è¡Œæ¼”ç¤ºï¼‰ï¼Œç„¶åæ‰§è¡Œæ„å»ºå‘½ä»¤ï¼ˆè¯¦è§`package.json`ï¼‰ã€‚

1. `npm run build:vue2:dev`æˆ–`yarn build:vue2:dev`
2. `npm run build:vue2:two:dev`æˆ–`yarn build:vue2:two:dev`

æ‰§è¡Œå®Œä»¥ä¸Šå‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†è¿™ä¸¤ä¸ªå­é¡¹ç›®çš„æ„å»ºç»“æœï¼ˆç»“æœè¾“å‡ºåˆ°`dist`ç›®å½•ä¸‹å¯¹åº”ç›®å½•ï¼‰ï¼Œæˆ‘ä»¬ç»™è¿™ä¸¤ä¸ªé¡¹ç›®æŒ‡ä»£ä¸€ä¸ªåå­—ï¼š

- é¡¹ç›®Aï¼š`vue2`
- é¡¹ç›®Bï¼š`vue2-two`

ä¾èµ–å…³ç³»ä¸ºï¼šé¡¹ç›®Bé‡‡ç”¨`module federation`ä½¿ç”¨äº†é¡¹ç›®Aæš´éœ²å‡ºæ¥çš„ä¸€ä¸ªè¿œç¨‹ç»„ä»¶ï¼Œæ•…Aæ˜¯æä¾›è€…ï¼ŒBæ˜¯æ¶ˆè´¹è€…ã€‚

é¦–å…ˆæ¥çœ‹çœ‹é¡¹ç›®Bä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…æ„å»ºçš„äº§ç‰©ï¼Œå¯¹äºè¿œç¨‹ç»„ä»¶æˆ–åº“çš„ä½¿ç”¨éƒ¨åˆ†æºç ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç¬”è€…è¿™é‡Œåˆ é™¤äº†ä¸€äº›å¤æ‚ä»£ç ï¼‰ï¼š

```js
// dist/vue2-two/hello-world.js

// ä¾èµ–çš„chunkå’Œå…¶å†…éƒ¨ä¾èµ–å…³ç³»ï¼Œè¿™é‡Œè¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨çš„ant-design-vueæ¥è‡ªwebpack/container/remote/@v2hw/ant-design-vue
var chunkMapping = {
	"webpack_container_remote_v2hw_ant-design-vue": [
		"webpack/container/remote/@v2hw/ant-design-vue"
	]
};
// å¯¹åº”æ¨¡å—çš„æ‰€æœ‰ä¾èµ–
var idToExternalAndNameMapping = {
	"webpack/container/remote/@v2hw/ant-design-vue": [
		"default",
		"./ant-design-vue",
		"webpack/container/reference/@v2hw"
	]
};
__webpack_require__.f.remotes = (chunkId, promises) => {
    // åˆ¤æ–­å½“å‰éœ€è¦åŠ è½½çš„chunkæ˜¯å¦åœ¨module-federationé…ç½®é¡¹ä¸­çš„remotesä¸­å£°æ˜ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦å­˜åœ¨äºä¸Šé¢çš„chunkMappingä¸­
	if(__webpack_require__.o(chunkMapping, chunkId)) {
        // æ ¹æ®å½“å‰åŠ è½½æ¨¡å—åœ¨chunkMappingä¸­çš„æ˜ å°„,æ‰¾åˆ°è¯¥chunkä¾èµ–çš„å…¶ä»–æ¨¡å—
		chunkMapping[chunkId].forEach((id) => {

            // æ ¹æ®æ‰€éœ€è¦åŠ è½½çš„æ¨¡å—åœ¨idToExternalAndNameMappingä¸­çš„æ˜ å°„ï¼Œæ‰¾åˆ°æ‰€éœ€è¦çš„å…¶ä»–ä¾èµ–
			var data = idToExternalAndNameMapping[id];

			var onFactory = (factory) => {
				data.p = 1;
				__webpack_modules__[id] = (module) => {
					module.exports = factory(); // è¿”å›åŠ è½½å®Œçš„æ¨¡å—å†…å®¹
				}
			};
		});
	}
}
```

ç»“åˆæºç çš„æ³¨é‡Šæ¥çœ‹,æˆ‘ä»¬å¯ä»¥å‘ç°å®ƒçš„æ•´ä¸ªæµç¨‹å¤§è‡´æ˜¯:

å¯¼å…¥ä¸€ä¸ªè¿œç¨‹æ¨¡å—  =>  è·å–è¯¥æ¨¡å—å¯¹åº”çš„å®é™…æ¥æº  =>  é€šè¿‡è¯¥æ¨¡å—`id`è·å–å…¶æ‰€æœ‰ä¾èµ–é¡¹  =>  å¾—åˆ°æœ€ç»ˆç»“æœ

## æ€»ç»“

é€šè¿‡è¿™ä¸€ç•ªä»‹ç»ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿå¯¹`Module Federation`è¿™é¡¹æŠ€æœ¯æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼Œå¦‚æœè¯´æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å†æ·±å…¥æŒ–æ˜æŒ–æ˜å®ƒçš„å…¶ä»–æœ‰æ„æ€çš„ç©æ³•ï¼Œç¬”è€…åœ¨æ¢ç´¢çš„è¿‡ç¨‹å½“ä¸­æ„Ÿå—åˆ°è¿™é¡¹æŠ€æœ¯çš„æ½œåŠ›ï¼Œåœ¨æœªæ¥ï¼Œæˆ–è®¸å®ƒå°†ä¼šæ˜¯å¾®å‰ç«¯çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼Œä¸€ä¸ªå¤©ç„¶æ”¯æŒè¿œç¨‹ç»„ä»¶è°ƒç”¨çš„æ–¹æ¡ˆã€‚

> å°å£°bbï¼šå…¨é¢æ‹¥æŠ±`Module Federation`ã€æŠ›å¼ƒå¾®å‰ç«¯ã€æŠ›å¼ƒ`iframe`ï¼Œ`webpack yes`ã€‚

## å‚è€ƒé“¾æ¥

[æ¢ç´¢ webpack5 æ–°ç‰¹æ€§ Module federation åœ¨è…¾è®¯æ–‡æ¡£çš„åº”ç”¨](http://www.alloyteam.com/2020/04/14338/)

[å®˜æ–¹æ–‡æ¡£](https://webpack.docschina.org/concepts/module-federation/)

[YYå›¢é˜Ÿemp](https://github.com/efoxTeam/emp/blob/main/README-zh_CN.md)

[ä¸€èµ·æ¥çœ‹ä¸€çœ‹Webpack Module Federation](https://zhuanlan.zhihu.com/p/245114955)

[ä¸‰å¤§åº”ç”¨åœºæ™¯è°ƒç ”ï¼ŒWebpack æ–°åŠŸèƒ½ Module Federation æ·±å…¥è§£æ](https://developer.aliyun.com/article/755252)
